<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Clarytiq AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Clerk Auth -->
  <script async crossorigin="anonymous"
    data-clerk-publishable-key="pk_test_cHJvdmVuLW1ha28tNTAuY2xlcmsuYWNjb3VudHMuZGV2JA"
    src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js">
    </script>

  <!-- Global Auth State + Clerk wiring -->
  <script>
    window.isUserLoggedIn = false;

    // Update navbar + PRO pills
    window.updateAuthUI = function () {
      const signInBtn = document.getElementById("openSignIn");
      const userBtnContainer = document.getElementById("clerk-user-button");

      if (!signInBtn || !userBtnContainer) return;

      if (window.isUserLoggedIn) {
        signInBtn.style.display = "none";
        userBtnContainer.style.display = "block";
      } else {
        signInBtn.style.display = "inline-flex";
        userBtnContainer.style.display = "none";
      }

      // Lock/unlock PRO labels visually
      const proButtons = document.querySelectorAll(
        '.preset-btn[data-preset="exam"], .preset-btn[data-preset="genz"], .preset-btn[data-preset="cause_effect"]'
      );

      proButtons.forEach(btn => {
        const pill = btn.querySelector(".preset-pro-pill");
        if (!pill) return;
        pill.style.display = window.isUserLoggedIn ? "none" : "inline-flex";
      });
    };

    window.addEventListener("load", async () => {
      const signInOverlay = document.getElementById("sign-in");
      const signInBox = document.getElementById("clerk-sign-in");
      const openSignInBtn = document.getElementById("openSignIn");
      const userBtnContainer = document.getElementById("clerk-user-button");

      // Global helper to open Clerk sign-in
      window.showSignInOverlay = function (e) {
        e?.stopPropagation();   // <-- ADD THIS

        window.showSignInOverlay = function (e) {
          e?.stopPropagation();

          if (!signInOverlay) return;

          // 1. Show instantly
          signInOverlay.style.display = "block";

          // 2. THEN animate (important)
          setTimeout(() => {
            signInOverlay.classList.add("show");
          }, 10);

          if (window.Clerk && signInBox && !signInBox.hasChildNodes()) {
            window.Clerk.mountSignIn(signInBox, {
              appearance: { baseTheme: "light" }
            });
          }
        };



        if (window.Clerk && signInBox && !signInBox.hasChildNodes()) {
          window.Clerk.mountSignIn(signInBox, {
            appearance: { baseTheme: "light" }
          });
        }
      };

      if (openSignInBtn) {
        openSignInBtn.addEventListener("click", (e) => {
          e.stopPropagation();  // <-- ADD THIS
          window.showSignInOverlay();
        });

      }

      if (!window.Clerk) {
        console.warn("Clerk not loaded yet");
        return;
      }

      try {
        await window.Clerk.load();

        const emit = () => {
          // user is null when signed out, object with id when signed in
          const user = window.Clerk.user;
          window.isUserLoggedIn = !!(user && user.id);
          window.updateAuthUI();
        };

        emit();
        window.Clerk.addListener(emit);

        if (userBtnContainer) {
          window.Clerk.mountUserButton(userBtnContainer, {
            afterSignOutUrl: window.location.href,
            appearance: { baseTheme: "light" }
          });
        }
      } catch (err) {
        console.error("Clerk load error:", err);
      }
    });
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- CSS -->
  <style>
    /* --------------------------------------------------
   FUTURE GLASS THEME (APP)
   -------------------------------------------------- */
    :root {
      --bg-deep: #020617;
      --accent-cyan: #22d3ee;
      --accent-violet: #8b5cf6;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --glass-bg: rgba(2, 6, 23, 0.6);
      --glass-panel: rgba(15, 23, 42, 0.6);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-highlight: rgba(255, 255, 255, 0.03);
      --glow: 0 0 20px rgba(34, 211, 238, 0.15);
      --danger: #ef4444;
      --success: #22c55e;
      --font-sans: "Inter", sans-serif;
      --shadow-btn: 0 0 20px rgba(34, 211, 238, 0.25);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-sans);
      margin: 0;
      padding: 0;
      background-color: var(--bg-deep);
      color: var(--text-primary);
      background-image:
        radial-gradient(circle at 10% 20%, rgba(139, 92, 246, 0.15), transparent 30%),
        radial-gradient(circle at 90% 80%, rgba(34, 211, 238, 0.15), transparent 30%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Aurora Overlay */
    body::before {
      content: "";
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 50% 50%, rgba(15, 23, 42, 0) 0%, rgba(2, 6, 23, 0.45) 100%);
      pointer-events: none;
      z-index: -1;
    }

    /* NAVBAR */
    .nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 1.4rem;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 999px;
      margin: 1.5rem auto;
      max-width: 1120px;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      position: sticky;
      top: 1rem;
      z-index: 10;
    }

    .nav h1,
    .nav div:first-child {
      font-weight: 800 !important;
      background: linear-gradient(to right, white, #94a3b8);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.02em;
    }

    #openSignIn {
      padding: 0.5rem 1.2rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--glass-border);
      color: white;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: all 0.3s;
    }

    #openSignIn:hover {
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
    }

    /* MAIN TOOL LAYOUT */
    .main-card {
      max-width: 1120px;
      margin: 2rem auto;
      background: transparent;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 900px) {
      .main-card {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: var(--glass-panel);
      padding: 1.5rem;
      border-radius: 1.5rem;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.25);
    }

    .textarea {
      width: 100%;
      min-height: 220px;
      border-radius: 1rem;
      padding: 1rem;
      border: 1px solid var(--glass-border);
      font-size: 1rem;
      resize: vertical;
      outline: none;
      background: rgba(0, 0, 0, 0.3);
      color: var(--text-primary);
      font-family: inherit;
    }

    .textarea:focus {
      border-color: var(--accent-cyan);
      box-shadow: 0 0 0 1px rgba(34, 211, 238, 0.3);
    }

    .textarea::placeholder {
      color: var(--text-secondary);
      opacity: 0.7;
    }

    .preset-btn {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      padding: 0.8rem 1rem;
      background: rgba(255, 255, 255, 0.03);
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      cursor: pointer;
      gap: 0.4rem;
      transition: all 0.2s;
    }

    .preset-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: white;
    }

    .preset-btn.selected {
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-violet));
      color: #000;
      font-weight: 600;
      border: none;
      box-shadow: 0 0 15px rgba(34, 211, 238, 0.4);
    }

    .preset-pro-pill {
      font-size: 0.7rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      background: rgba(255, 255, 255, 0.1);
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    /* HUMANIZE BUTTON */
    #humanizeBtn {
      margin-top: 1rem;
      width: 100%;
      border-radius: 1rem;
      padding: 1rem 1rem;
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(135deg, #0066ff, #22d3ee);
      color: white;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      box-shadow: 0 0 25px rgba(0, 102, 255, 0.4);
      transition: all 0.3s;
    }

    #humanizeBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 40px rgba(0, 102, 255, 0.6);
    }

    #humanizeCounterRow {
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-align: right;
    }

    /* OUTPUT */
    .output-box {
      min-height: 220px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 1rem;
      padding: 1rem;
      border: 1px solid var(--glass-border);
      overflow-y: auto;
      font-size: 1rem;
      line-height: 1.6;
      color: var(--text-primary);
    }

    /* MODALS */
    .pro-modal-overlay {
      position: fixed !important;
      inset: 0 !important;
      background: rgba(0, 0, 0, 0.7) !important;
      backdrop-filter: blur(10px) !important;
      display: none;
      align-items: center !important;
      justify-content: center !important;
      z-index: 999999 !important;
    }


    .pro-modal {
      background: #0f172a !important;
      border: 1px solid var(--glass-border) !important;
      padding: 2rem !important;
      border-radius: 1.5rem !important;
      max-width: 500px !important;
      width: 90% !important;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6) !important;
      position: relative !important;
      z-index: 9999999 !important;
      color: white !important;
    }

    .pro-modal h2 {
      color: white;
    }


    /* TOAST */
    #toast {
      position: fixed;
      right: 1.5rem;
      bottom: 1.5rem;
      padding: 0.8rem 1.2rem;
      background: var(--success);
      color: white;
      border-radius: 999px;
      opacity: 0;
      pointer-events: none;
      transition: 0.25s;
      font-size: 0.9rem;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    /* --- Clerk popup animation --- */

    #sign-in {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.35s ease, transform 0.35s ease;
    }

    #sign-in.show {
      opacity: 1;
      transform: translateY(0);
    }
  </style>

  <script defer data-domain="clarytiq.com" src="https://plausible.io/js/script.js">
  </script>


</head>

<body>

  <!-- Clerk Sign-In Overlay -->
  <div id="sign-in" style="
    display:none;
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,0.45);
    backdrop-filter: blur(6px);
    z-index: 9999;
    padding-top: 4rem;
  ">
    <div id="clerk-sign-in" style="max-width: 360px; margin: auto;"></div>
  </div>

  <!-- NAVBAR -->
  <header class="nav">
    <div style="font-weight:800; font-size:1.1rem;">Clarytiq AI</div>
    <div style="display:flex; align-items:center; gap:0.8rem;">
      <button id="openSignIn">Sign In ‚ö°</button>
      <div id="clerk-user-button" style="display:none;"></div>
    </div>
  </header>

  <!-- HERO -->
  <section style="text-align:center; margin-top:2rem;">
    <h1 style="
      font-size:clamp(2.2rem,4vw,2.8rem);
      font-weight:800;
      margin-bottom:0.5rem;
      color:#020617;
    ">
      Turn robotic notes into <span style="color:var(--accent-blue);">human text.</span>
    </h1>

    <p style="color:var(--text-muted); font-size:1rem; max-width:580px; margin:0 auto;">
      Paste your text, choose a mode, and get natural, exam-ready notes within seconds.
    </p>
  </section>

  <!-- MAIN TOOL -->
  <main class="main-card" id="tool-card">

    <!-- LEFT PANEL -->
    <section class="panel">
      <h3 style="margin:0 0 0.3rem 0; font-size:0.9rem; color:var(--text-muted);">Paste your text</h3>
      <textarea id="inputText" class="textarea" placeholder="Paste AI-generated or class notes here‚Ä¶"
        maxlength="2000"></textarea>

      <div
        style="display:flex; justify-content:space-between; margin-top:0.25rem; font-size:0.78rem; color:var(--text-soft);">
        <div id="inputError" style="color:var(--danger);"></div>
        <div id="charCounter">0 / 2000 characters</div>
      </div>

      <!-- PRESETS -->
      <div style="margin-top:1rem;">
        <h4 style="font-size:0.8rem; color:var(--text-muted); margin-bottom:0.4rem;">Choose mode</h4>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:0.5rem;">

          <!-- FREE -->
          <button class="preset-btn selected" data-preset="simple">
            <span>Simple Explainer</span>
          </button>

          <button class="preset-btn" data-preset="simple_words">
            <span>Easy Words (Free)</span>
          </button>

          <!-- PRO -->
          <button class="preset-btn" data-preset="exam">
            <span>Exam Ready</span>
            <span class="preset-pro-pill">PRO</span>
          </button>

          <button class="preset-btn" data-preset="genz">
            <span>Gen-Z Mode</span>
            <span class="preset-pro-pill">PRO</span>
          </button>

          <button class="preset-btn" data-preset="cause_effect">
            <span>Cause ‚Üí Effect</span>
            <span class="preset-pro-pill">PRO</span>
          </button>

        </div>
      </div>

      <!-- PRESET DESCRIPTION -->
      <div id="presetPreview" style="
        margin-top:0.8rem;
        padding:0.7rem;
        border-radius:0.8rem;
        font-size:0.82rem;
        background:white;
        border:1px solid #cbd5e1;
        color:#475569;
        display:none;
      "></div>

      <!-- COUNTER ABOVE BUTTON -->
      <div id="humanizeCounterRow">
        <span id="humanizeCounter">(0 left today)</span>
      </div>

      <!-- HUMANIZE BUTTON -->
      <button id="humanizeBtn">
        ‚ú® Humanize Notes
      </button>
    </section>

    <!-- RIGHT PANEL -->
    <section class="panel">
      <h3 style="margin:0 0 0.3rem 0; font-size:0.9rem; color:var(--text-muted);">Result</h3>

      <div id="outputBox" class="output-box">
        <div style="color:#cbd5e1;">Your humanized notes will appear here‚Ä¶</div>
      </div>

      <div id="outputError" style="color:var(--danger); font-size:0.78rem; margin-top:0.3rem;"></div>

      <div style="
        display:flex;
        justify-content:space-between;
        margin-top:0.8rem;
        flex-wrap:wrap;
        gap:0.6rem;
      ">
        <button id="copyBtn" class="preset-btn" style="flex:1;">üìã Copy</button>
        <button id="downloadBtn" class="preset-btn" style="flex:1;">‚¨áÔ∏è Download</button>
      </div>

      <div style="margin-top:0.9rem; font-size:0.78rem; color:var(--text-soft);">
        Mode used:
        <span id="modeUsed" style="
          padding:0.15rem 0.5rem;
          border-radius:999px;
          background:#e2e8f0;
          font-weight:600;
        ">SIMPLE</span>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer style="
    max-width:1120px;
    margin:2.5rem auto;
    padding:1.2rem 0;
    text-align:center;
    color:var(--text-muted);
    font-size:0.85rem;
  ">
    <div style="
  text-align:center; 
  margin-top:2.5rem;
  margin-bottom:2rem;
">
      <a href="/pricing.html" style="
    display:inline-block;
    padding:0.9rem 2rem;
    background:linear-gradient(135deg, #0ea5e9, #22c55e);
    color:white;
    border-radius:999px;
    font-size:1.1rem;
    font-weight:700;
    text-decoration:none;
    box-shadow:0 10px 30px rgba(14,165,233,0.35);
    transition:transform 0.15s ease, box-shadow 0.15s ease;
  " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 14px 35px rgba(14,165,233,0.45)';"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(14,165,233,0.35)';">
        üöÄ Upgrade to PRO
      </a>

      <p style="margin-top:0.6rem; color:#64748b; font-size:0.9rem;">
        Unlock all modes, unlimited rewrites, and full power.
      </p>
    </div>

  </footer>

  <!-- PRO EXAMPLE MODAL -->
  <div id="proExampleModal" class="pro-modal-overlay">
    <div class="pro-modal">
      <h2 style="margin-bottom:0.4rem;">PRO Rewrite Example üîí</h2>
      <p style="font-size:0.85rem; color:#64748b;">Here‚Äôs how PRO transforms your notes:</p>

      <div id="exampleInput" style="
        margin-top:1rem;
        padding:1rem;
        background:#f1f5f9;
        border-radius:0.7rem;
        white-space:pre-wrap;
        font-size:0.9rem;
      "></div>

      <div id="exampleOutput" style="
        margin-top:1rem;
        padding:1rem;
        background:white;
        border:1px solid #cbd5e1;
        border-radius:0.7rem;
        white-space:pre-wrap;
        box-shadow:0 6px 14px rgba(15,23,42,0.08);
        font-size:0.9rem;
      "></div>

      <button id="buyProBtn" style="
        margin-top:1.3rem;
        width:100%;
        padding:0.7rem;
        background:linear-gradient(135deg,#0ea5e9,#22c55e);
        color:white;
        border-radius:999px;
        font-weight:700;
        border:none;
        cursor:pointer;
      ">
        Buy PRO now ‚Üí
      </button>

      <button id="proExampleCloseBtn" style="
        margin-top:0.6rem;
        width:100%;
        padding:0.6rem;
        background:white;
        border:1px solid #cbd5e1;
        border-radius:999px;
        cursor:pointer;
      ">
        Close
      </button>

      <p style="margin-top:0.6rem; font-size:0.78rem; color:#64748b; text-align:center;">
        or <a href="/pricing.html" style="color:#0ea5e9; font-weight:600;">open pricing page</a> in a new tab.
      </p>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast">
    <span id="toastMessage">Copied!</span>
  </div>

  <!-- APP LOGIC -->
  <script>
    (function initNotesHumanizer() {

      /* ===============================
          CREDIT SYSTEM CONFIG
      =============================== */

      const LIMITS = {
        beforeLogin: { simple: 3, simple_words: 3 },
        afterLogin: { simple: 15, simple_words: 15, genz: 5, exam: 5, cause_effect: 5 }
      };

      const PRO_MODES = ["genz", "exam", "cause_effect"];

      function loadCredits() {
        const today = new Date().toDateString();
        const saved = JSON.parse(localStorage.getItem("nh_credits"));

        if (!saved || saved.date !== today) {
          const fresh = {
            date: today,
            beforeLogin: { ...LIMITS.beforeLogin },
            afterLogin: { ...LIMITS.afterLogin }
          };
          localStorage.setItem("nh_credits", JSON.stringify(fresh));
          return fresh;
        }
        return saved;
      }

      function saveCredits(data) {
        localStorage.setItem("nh_credits", JSON.stringify(data));
      }

      let credits = loadCredits();

      function getCreditsLeft(preset) {
        const pool = window.isUserLoggedIn ? credits.afterLogin : credits.beforeLogin;
        const val = pool && typeof pool[preset] === "number" ? pool[preset] : 0;
        return val;
      }

      function hasCredit(preset) {
        return getCreditsLeft(preset) > 0;
      }

      function useCredit(preset) {
        if (window.isUserLoggedIn) {
          if (typeof credits.afterLogin[preset] === "number") {
            credits.afterLogin[preset]--;
          }
        } else {
          if (typeof credits.beforeLogin[preset] === "number") {
            credits.beforeLogin[preset]--;
          }
        }
        saveCredits(credits);
      }

      /* ===============================
          UI ELEMENTS
      =============================== */

      const input = document.getElementById("inputText");
      const outputBox = document.getElementById("outputBox");
      const outputErr = document.getElementById("outputError");
      const inputErr = document.getElementById("inputError");
      const presetButtons = [...document.querySelectorAll(".preset-btn")];
      const presetPreview = document.getElementById("presetPreview");
      const modeUsedEl = document.getElementById("modeUsed");

      const humanizeBtn = document.getElementById("humanizeBtn");
      const humanizeCounter = document.getElementById("humanizeCounter");

      const charCounter = document.getElementById("charCounter");

      let selectedPreset = "simple";
      let outputText = "";

      /* ===============================
          CREDIT COUNTER DISPLAY
      =============================== */

      function updateCreditCounter() {
        const left = getCreditsLeft(selectedPreset);

        if (PRO_MODES.includes(selectedPreset)) {
          if (!window.isUserLoggedIn) {
            humanizeCounter.textContent = "(Login required for this mode)";
          } else {
            humanizeCounter.textContent = `(${left} PRO tries left today)`;
          }
        } else {
          humanizeCounter.textContent = `(${left} left today)`;
        }
      }

      updateCreditCounter();

      /* ===============================
          PRESET LOGIC
      =============================== */

      const PRESET_DESC = {
        simple: "Makes your text sound human and clean.",
        simple_words: "Explains ideas in very simple words.",
        exam: "Exam-style, formal school answers. (PRO Trial)",
        genz: "Dark humour, emojis, Gen-Z tone. (PRO Trial)",
        cause_effect: "Cause ‚Üí Effect logic chain explanation. (PRO Trial)"
      };

      presetButtons.forEach(btn => {
        btn.addEventListener("click", () => {
          selectedPreset = btn.dataset.preset;

          presetButtons.forEach(b => b.classList.remove("selected"));
          btn.classList.add("selected");

          modeUsedEl.textContent = selectedPreset.toUpperCase();

          presetPreview.style.display = "block";
          presetPreview.textContent = PRESET_DESC[selectedPreset] || "";

          updateCreditCounter();
        });
      });

      /* ===============================
          API CALL WRAPPER
      =============================== */

      async function callAI(preset, text) {
        try {
          const res = await fetch("/api/humanize", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ preset, userText: text })
          });
          const data = await res.json();
          return data.output;
        } catch (err) {
          console.error("API error:", err);
          return null;
        }
      }

      /* ===============================
          HUMANIZE BUTTON
      =============================== */

      const exampleModal = document.getElementById("proExampleModal");
      exampleModal.addEventListener("click", (e) => {
        e.stopPropagation(); // prevent overlay from closing instantly
      });

      document.querySelector(".pro-modal").addEventListener("click", (e) => {
        e.stopPropagation();  // prevents modal from closing instantly
      });

      const exampleInput = document.getElementById("exampleInput");
      const exampleOutput = document.getElementById("exampleOutput");

      const signInOverlay = document.getElementById("sign-in");
      document.getElementById("clerk-sign-in").addEventListener("click", (e) => {
        e.stopPropagation();
      });


      const PRO_EXAMPLES = {
        genz: {
          input: "The French Revolution changed France.",
          output: "Bruhh France woke up and chose *violence* üíÄüî•. King said 'stop', people said 'no'. Now boom‚Äîrevolution."
        },
        exam: {
          input: "The French Revolution changed France.",
          output: "The French Revolution brought major political, economic, and social reforms to France."
        },
        cause_effect: {
          input: "Taxes increased in France.",
          output: "Cause ‚Üí Effect:\n‚Ä¢ Higher taxes ‚Üí Public anger ‚Üí Protests.\n‚Ä¢ Food prices rose ‚Üí Riots.\n‚Ä¢ Govt debt increased ‚Üí Collapse of monarchy."
        }
      };

      humanizeBtn.addEventListener("click", async (e) => {
        if (window.plausible) plausible("Humanize Click");

        e.stopPropagation();   // <-- ADD THIS

        inputErr.textContent = "";
        outputErr.textContent = "";

        const text = input.value.trim();
        if (!text) {
          inputErr.textContent = "Paste some text first.";
          return;
        }

        // NO CREDIT STATE
        if (!hasCredit(selectedPreset)) {
          console.log("NO CREDIT | loggedIn =", window.isUserLoggedIn, "| preset =", selectedPreset);

          // CASE 1 ‚Üí NOT LOGGED IN ‚Üí ALWAYS SHOW LOGIN POPUP
          if (!window.isUserLoggedIn) {
            console.log("OPENING CLERK LOGIN POPUP");

            if (window.showSignInOverlay) {
              window.showSignInOverlay();
            } else {
              // Backup if function fails
              const overlay = document.getElementById("sign-in");
              if (overlay) overlay.style.display = "block";

              const box = document.getElementById("clerk-sign-in");
              if (window.Clerk && box && !box.hasChildNodes()) {
                window.Clerk.mountSignIn(box, { appearance: { baseTheme: "light" } });
              }
            }

            return; // STOP HERE
          }

          // CASE 2 ‚Üí LOGGED IN ‚Üí SHOW PRO EXAMPLE POPUP
          console.log("OPENING PRO EXAMPLE POPUP");

          const example = PRO_EXAMPLES[selectedPreset] || {
            input: "You completed all free credits.",
            output: "Unlock PRO to continue using this mode!"
          };

          exampleInput.textContent = example.input;
          exampleOutput.textContent = example.output;
          exampleModal.style.display = "flex";
          e.stopPropagation();  // <-- ADD THIS


          return;
        }


        // USE CREDIT
        useCredit(selectedPreset);
        updateCreditCounter();

        // Loading skeleton
        outputBox.innerHTML = `
        <div style="display:flex; flex-direction:column; gap:0.4rem;">
          <div style="height:0.75rem; background:#e2e8f0; border-radius:999px;"></div>
          <div style="height:0.75rem; background:#e2e8f0; border-radius:999px; width:90%;"></div>
          <div style="height:0.75rem; background:#e2e8f0; border-radius:999px; width:80%;"></div>
        </div>
      `;

        const result = await callAI(selectedPreset, text);

        if (!result) {
          outputErr.textContent = "Something went wrong. Try again.";
          return;
        }

        outputText = result;
        outputBox.innerHTML = result.replace(/\n/g, "<br>");
      });

      /* ===============================
          COPY & DOWNLOAD
      =============================== */

      const toast = document.getElementById("toast");
      const toastMsg = document.getElementById("toastMessage");

      function showToast(msg) {
        toastMsg.textContent = msg;
        toast.style.opacity = 1;
        setTimeout(() => {
          toast.style.opacity = 0;
        }, 1500);
      }

      document.getElementById("copyBtn").addEventListener("click", () => {
        navigator.clipboard.writeText(outputText || "");
        showToast("Copied!");
      });

      document.getElementById("downloadBtn").addEventListener("click", () => {
        const blob = new Blob([outputText || ""], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "humanized.txt";
        link.click();
      });

      /* ===============================
          CLOSE MODALS
      =============================== */

      document.getElementById("proExampleCloseBtn").addEventListener("click", () => {
        exampleModal.style.display = "none";
      });

      // Close PRO modal when clicking OUTSIDE the modal box
      // Close PRO modal only when clicking OUTSIDE the modal box
      // Stop clicks INSIDE modal from closing it
      document.querySelector(".pro-modal").addEventListener("click", (e) => {
        e.stopPropagation();
      });

      // Close modal only when clicking OUTSIDE the modal
      exampleModal.addEventListener("click", (e) => {
        const box = document.querySelector(".pro-modal");
        if (!box.contains(e.target)) {
          exampleModal.style.display = "none";
        }
      });



      // Close Clerk sign-in when clicking OUTSIDE the sign-in box
      signInOverlay.addEventListener("click", (e) => {
        const box = document.getElementById("clerk-sign-in");
        if (!box.contains(e.target)) {
          signInOverlay.classList.remove("show");
          setTimeout(() => {
            signInOverlay.style.display = "none";
          }, 300); // matches animation length

        }
      });
      ;


      document.getElementById("buyProBtn").addEventListener("click", () => {
        window.location.href = "/pricing.html";
      });

      /* ===============================
          CHARACTER COUNTER
      =============================== */

      input.addEventListener("input", function () {
        const count = this.value.length;
        charCounter.textContent = `${count} / 2000 characters`;
      });

    })();
  </script>

  <!-- ESC key + optional scroll -->
  <script>
    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape") {
        const signInOverlay = document.getElementById("sign-in");
        const proModal = document.getElementById("proExampleModal");

        if (signInOverlay && signInOverlay.style.display === "block") {
          signInOverlay.style.display = "none";
        }
        if (proModal && proModal.style.display === "flex") {
          proModal.style.display = "none";
        }
      }
    });

    const scrollBtn = document.getElementById("landing-scroll-btn");
    if (scrollBtn) {
      scrollBtn.addEventListener("click", () => {
        document.getElementById("tool-card")?.scrollIntoView({ behavior: "smooth" });
      });
    }
  </script>

</body>

</html>